<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Module: BBCode</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
  <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'><tr>
  <td class="file-title"><span class="file-title-prefix">Module</span><br />BBCode</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../files/lib/more/facets/bbcode_rb.html">lib/more/facets/bbcode.rb</a>
        </td>
      </tr>
         </table>
        </td>
        </tr>
      </table>
 <!-- banner header -->

  <div id="bodyContent">
      <div id="content">

  <div class="description"><h1><a href="BBCode.html">BBCode</a></h1>
<p>
The <a href="BBCode.html">BBCode</a> module helps ease the separation of
core and frontend with the core (or submodules) being still able to say,
what colors shall be used in it&#8216;s responses. This is achieved by
encoding formatting information using the <a href="BBCode.html">BBCode</a>
tokens. This enables you to &quot;pipe&quot; layout information such as
colors, style, fonttype, size and alignment through the core to the
frontend.
</p>
<p>
Additionally it converts markups/codes between ANSI, HTML and <a
href="BBCode.html">BBCode</a> almost freely ;)
</p>
<h2>Usage</h2>
<pre>
  # Converting a bbcode string to ANSI and XHTML

  str = &quot;this is [COLOR=red]red[/COLOR], this is [B]bold[/B]&quot;
  print( BBCode.bbcode_to_ansi(str) )
  print( BBCode.bbcode_to_html(str) )
</pre>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="#M000907">ansi</a></li>
  <li><a href="#M000909">ansi_to_bbcode</a></li>
  <li><a href="#M000913">ansi_to_html</a></li>
  <li><a href="#M000910">bbcode_to_ansi</a></li>
  <li><a href="#M000912">bbcode_to_html</a></li>
  <li><a href="#M000914">html_to_ansi</a></li>
  <li><a href="#M000911">html_to_bbcode</a></li>
  <li><a href="#M000908">strip_bbcode</a></li>
  </ul>




  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">ANSINAME2CODE</td>
    <td>=</td>
    <td class="attr-value">{  &quot;reset&quot;     =&gt; &quot;\e[0m&quot;,    &quot;bold&quot;       =&gt; &quot;\e[1m&quot;,                     &quot;underline&quot; =&gt; &quot;\e[4m&quot;,    &quot;blink&quot;      =&gt; &quot;\e[5m&quot;,                     &quot;reverse&quot;   =&gt; &quot;\e[7m&quot;,    &quot;invisible&quot;  =&gt; &quot;\e[8m&quot;,                     &quot;black&quot;     =&gt; &quot;\e[0;30m&quot;, &quot;darkgrey&quot;   =&gt; &quot;\e[1;30m&quot;,                     &quot;red&quot;       =&gt; &quot;\e[0;31m&quot;, &quot;lightred&quot;   =&gt; &quot;\e[1;31m&quot;,                     &quot;green&quot;     =&gt; &quot;\e[0;32m&quot;, &quot;lightgreen&quot; =&gt; &quot;\e[1;32m&quot;,                     &quot;brown&quot;     =&gt; &quot;\e[0;33m&quot;, &quot;yellow&quot;     =&gt; &quot;\e[1;33m&quot;,                     &quot;blue&quot;      =&gt; &quot;\e[0;34m&quot;, &quot;lightblue&quot;  =&gt; &quot;\e[1;34m&quot;,                     &quot;purple&quot;    =&gt; &quot;\e[0;35m&quot;, &quot;magenta&quot;    =&gt; &quot;\e[1;35m&quot;,                     &quot;cyan&quot;      =&gt; &quot;\e[1;36m&quot;, &quot;lightcyan&quot;  =&gt; &quot;\e[1;36m&quot;,                     &quot;grey&quot;      =&gt; &quot;\e[0;37m&quot;, &quot;white&quot;      =&gt; &quot;\e[1;37m&quot;,                     &quot;bgblack&quot;   =&gt; &quot;\e[40m&quot;,   &quot;bgred&quot;      =&gt; &quot;\e[41m&quot;,                     &quot;bggreen&quot;   =&gt; &quot;\e[42m&quot;,   &quot;bgyellow&quot;   =&gt; &quot;\e[43m&quot;,                     &quot;bgblue&quot;    =&gt; &quot;\e[44m&quot;,   &quot;bgmagenta&quot;  =&gt; &quot;\e[45m&quot;,                     &quot;bgcyan&quot;    =&gt; &quot;\e[46m&quot;,   &quot;bgwhite&quot;    =&gt; &quot;\e[47m&quot;</td>
  </tr>
  <tr valign='top'>
    <td>&nbsp;</td>
    <td colspan="2" class="attr-desc">
ANSIname =&gt; ANSIcode LUT

</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">BBCOLOR2ANSI</td>
    <td>=</td>
    <td class="attr-value">{ &quot;skyblue&quot;   =&gt; &quot;blue&quot;,     &quot;royalblue&quot; =&gt; &quot;blue&quot;,                     &quot;blue&quot;      =&gt; &quot;blue&quot;,     &quot;darkblue&quot;  =&gt; &quot;blue&quot;,                     &quot;orange&quot;    =&gt; &quot;red&quot;,      &quot;orangered&quot; =&gt; &quot;red&quot;,                     &quot;crimson&quot;   =&gt; &quot;red&quot;,      &quot;red&quot;       =&gt; &quot;lightred&quot;,                     &quot;firebrick&quot; =&gt; &quot;red&quot;,      &quot;darkred&quot;   =&gt; &quot;red&quot;,                     &quot;green&quot;     =&gt; &quot;green&quot;,    &quot;limegreen&quot; =&gt; &quot;green&quot;,                     &quot;seagreen&quot;  =&gt; &quot;green&quot;,    &quot;darkgreen&quot; =&gt; &quot;green&quot;,                     &quot;deeppink&quot;  =&gt; &quot;magenta&quot;,  &quot;tomato&quot;    =&gt; &quot;red&quot;,                     &quot;coral&quot;     =&gt; &quot;cyan&quot;,     &quot;purple&quot;    =&gt; &quot;purple&quot;,                     &quot;indigo&quot;    =&gt; &quot;blue&quot;,     &quot;burlywood&quot; =&gt; &quot;red&quot;,                     &quot;sandybrown&quot;=&gt; &quot;red&quot;,      &quot;sierra&quot;    =&gt; &quot;sierra&quot;,                     &quot;chocolate&quot; =&gt; &quot;brown&quot;,    &quot;teal&quot;      =&gt; &quot;teal&quot;,                     &quot;silver&quot;    =&gt; &quot;white&quot;,                     &quot;black&quot;     =&gt; &quot;black&quot;,    &quot;yellow&quot;    =&gt; &quot;yellow&quot;,                     &quot;magenta&quot;   =&gt; &quot;magenta&quot;,  &quot;cyan&quot;      =&gt; &quot;cyan&quot;,                     &quot;white&quot;     =&gt; &quot;white&quot;</td>
  </tr>
  <tr valign='top'>
    <td>&nbsp;</td>
    <td colspan="2" class="attr-desc">
BBColor =&gt; ANSIname LUT

</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">ANSINAME2BBCODE</td>
    <td>=</td>
    <td class="attr-value">{ &quot;bold&quot; =&gt; &quot;B&quot;, &quot;underline&quot; =&gt; &quot;U&quot;, &quot;reverse&quot; =&gt; &quot;I&quot;,                        &quot;red&quot;    =&gt; &quot;COLOR=red&quot;,      &quot;blue&quot;   =&gt; &quot;COLOR=blue&quot;,                       &quot;green&quot;  =&gt; &quot;COLOR=green&quot;,    &quot;cyan&quot;   =&gt; &quot;COLOR=cyan&quot;,                       &quot;magenta&quot;=&gt; &quot;COLOR=deeppink&quot;, &quot;purple&quot; =&gt; &quot;COLOR=purple&quot;,                       &quot;black&quot;  =&gt; &quot;COLOR=black&quot;,    &quot;white&quot;  =&gt; &quot;COLOR=white&quot;,                       &quot;yellow&quot; =&gt; &quot;COLOR=yellow&quot;,   &quot;brown&quot;  =&gt; &quot;COLOR=chocolate&quot;</td>
  </tr>
  <tr valign='top'>
    <td>&nbsp;</td>
    <td colspan="2" class="attr-desc">
ANSInames =&gt; <a href="BBCode.html">BBCode</a> LUT

</td>
  </tr>
  </table>


<div class="sectiontitle">Public Class methods</div>
<div class="method">
  <div class="title">
    <a name="M000907"></a><b>ansi</b>(colorname)
  </div>
  <div class="description">
  <p>
Returns the ANSI sequence for given color, if existant
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000907_source')" id="l_M000907_source">show source</a> ]</p>
  <div id="M000907_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 116</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi</span>(<span class="ruby-identifier">colorname</span>)
      <span class="ruby-identifier">colorname</span>.<span class="ruby-identifier">strip!</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-constant">ANSINAME2CODE</span>[ <span class="ruby-identifier">colorname</span>.<span class="ruby-identifier">downcase</span> ]
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000909"></a><b>ansi_to_bbcode</b>(string)
  </div>
  <div class="description">
  <p>
Returns the string with all <a href="BBCode.html#M000907">ansi</a> escape
sequences converted to BBCodes
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000909_source')" id="l_M000909_source">show source</a> ]</p>
  <div id="M000909_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 129</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi_to_bbcode</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-value str">&quot;&quot;</span>
      <span class="ruby-identifier">tagstack</span> = []

      <span class="ruby-comment cmt">## Iterate over input lines</span>
      <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">ansi</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\e\[[0-9;]+m/</span>)
          <span class="ruby-identifier">continue</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ansi</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ansi</span>.<span class="ruby-identifier">empty?</span>

          <span class="ruby-comment cmt">## Iterate over found ansi sequences</span>
          <span class="ruby-identifier">ansi</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">seq</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">ansiname</span> = <span class="ruby-constant">ANSINAME2CODE</span>.<span class="ruby-identifier">invert</span>[<span class="ruby-node">&quot;#{seq}&quot;</span>]

              <span class="ruby-comment cmt">## Pop last tag and form closing tag</span>
              <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ansiname</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;reset&quot;</span>
                  <span class="ruby-identifier">lasttag</span> = <span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">pop</span>
                  <span class="ruby-identifier">bbname</span> = <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">lasttag</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;=&quot;</span>)[<span class="ruby-value">0</span>] )

              <span class="ruby-comment cmt">## Get corresponding BBCode tag + Push to stack</span>
              <span class="ruby-keyword kw">else</span>
                  <span class="ruby-identifier">bbname</span>   = <span class="ruby-constant">ANSINAME2BBCODE</span>[<span class="ruby-identifier">ansiname</span>]
                  <span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">bbname</span>)
              <span class="ruby-keyword kw">end</span>

              <span class="ruby-comment cmt">## Replace ansi sequence by BBCode tag</span>
              <span class="ruby-identifier">replace</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;[%s]&quot;</span>, <span class="ruby-identifier">bbname</span>)
              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-node">&quot;#{Regexp.quote(seq)}&quot;</span>, <span class="ruby-identifier">replace</span>)
          <span class="ruby-keyword kw">end</span>

          <span class="ruby-comment cmt">## Append converted line</span>
          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s\n&quot;</span>, <span class="ruby-identifier">line</span>)
      <span class="ruby-keyword kw">end</span>


      <span class="ruby-comment cmt">## Some tags are unclosed</span>
      <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;[/%s]&quot;</span>, <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;=&quot;</span>)[<span class="ruby-value">0</span>])  )
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000913"></a><b>ansi_to_html</b>(string)
  </div>
  <div class="description">
  <p>
Converts a ANSI string to one with HTML markup. Returns the string with
ANSI code sequences converted to XHTML markup.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000913_source')" id="l_M000913_source">show source</a> ]</p>
  <div id="M000913_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 347</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi_to_html</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-identifier">bbcoded</span> = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi_to_bbcode</span>(<span class="ruby-identifier">string</span> )
      <span class="ruby-identifier">htmled</span>  = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_html</span>(<span class="ruby-identifier">bbcoded</span>)

      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">htmled</span>
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000910"></a><b>bbcode_to_ansi</b>(string, usecolors = true)
  </div>
  <div class="description">
  <p>
Converts a <a href="BBCode.html">BBCode</a> string to one with ANSI
sequences. Returns the string with all formatting instructions in BBCodes
converted to ANSI code sequences / aligned with spaces to specified width.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000910_source')" id="l_M000910_source">show source</a> ]</p>
  <div id="M000910_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 175</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_ansi</span>(<span class="ruby-identifier">string</span>, <span class="ruby-identifier">usecolors</span> = <span class="ruby-keyword kw">true</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-value str">&quot;&quot;</span>

      <span class="ruby-keyword kw">return</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">strip_bbcode</span>(<span class="ruby-identifier">string</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">usecolors</span>

      <span class="ruby-comment cmt">## Iterate over lines</span>
      <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>

          <span class="ruby-comment cmt">## TODO: stacking? other styles!</span>
          <span class="ruby-constant">ANSINAME2BBCODE</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[#{val}\]/</span>, <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-identifier">key</span>])
              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[\/#{val}\]/</span>, <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-value str">&quot;reset&quot;</span>])
          <span class="ruby-keyword kw">end</span>

          <span class="ruby-comment cmt">## Fonttypes and sizes not available</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[SIZE=\d\]/</span>, <span class="ruby-value str">&quot;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/SIZE\]/</span>, <span class="ruby-value str">&quot;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[FONT=[^\]]*\]/</span>, <span class="ruby-value str">&quot;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/FONT\]/</span>, <span class="ruby-value str">&quot;&quot;</span>)

          <span class="ruby-comment cmt">## Color-mapping</span>
          <span class="ruby-identifier">colors</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\[COLOR=(.*?)\]/i</span>)
          <span class="ruby-identifier">colors</span> = <span class="ruby-identifier">colors</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">s</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_s</span>} <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">colors</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">colors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">name</span> = <span class="ruby-constant">BBCOLOR2ANSI</span>[<span class="ruby-identifier">col</span>.<span class="ruby-identifier">downcase</span>]
              <span class="ruby-identifier">name</span> = <span class="ruby-constant">BBCOLOR2ANSI</span>[<span class="ruby-value str">&quot;white&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">code</span> = <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-identifier">name</span>]

              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[COLOR=#{col}\]/i</span>, <span class="ruby-identifier">code</span>)
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/COLOR\]/</span>, <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-value str">&quot;reset&quot;</span>])

          <span class="ruby-comment cmt">## TODO: Alignment</span>
          <span class="ruby-comment cmt">## TODO: IMGs</span>
          <span class="ruby-comment cmt">## TODO: EMAILs</span>
          <span class="ruby-comment cmt">## TODO: URLs</span>
          <span class="ruby-comment cmt">## TODO: QUOTEs</span>
          <span class="ruby-comment cmt">## TODO: LISTs</span>

          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s\n&quot;</span>, <span class="ruby-identifier">line</span>)
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000912"></a><b>bbcode_to_html</b>(string)
  </div>
  <div class="description">
  <p>
Converts a <a href="BBCode.html">BBCode</a> string to one with HTML markup.
Returns the string with all formatting instructions in BBCodes converted to
XHTML markups.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000912_source')" id="l_M000912_source">show source</a> ]</p>
  <div id="M000912_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 282</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_html</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-value str">&quot;&quot;</span>
      <span class="ruby-identifier">quote</span> = <span class="ruby-value">0</span>

      <span class="ruby-comment cmt">## Iterate over lines</span>
      <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">styles</span> = { <span class="ruby-value str">&quot;b&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;strong&quot;</span>, <span class="ruby-value str">&quot;i&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;em&quot;</span>, <span class="ruby-value str">&quot;u&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;u&quot;</span> }

          <span class="ruby-comment cmt">## preserve B, I, U</span>
          <span class="ruby-identifier">styles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">code</span>,<span class="ruby-identifier">html</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[#{code}\]/i</span>, <span class="ruby-node">&quot;&lt;#{html}&gt;&quot;</span>)
              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[\/#{code}\]/i</span>, <span class="ruby-node">&quot;&lt;/#{html}&gt;&quot;</span>)
          <span class="ruby-keyword kw">end</span>

          <span class="ruby-comment cmt">## COLOR =&gt; font color=... (TODO: should be numeric!)</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[COLOR=(.*?)\]/i</span>, <span class="ruby-value str">&quot;&lt;font color=\&quot;\\1\&quot;&gt;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/COLOR\]/i</span>,     <span class="ruby-value str">&quot;&lt;/font&gt;&quot;</span>)

          <span class="ruby-comment cmt">## SIZE =&gt; font size=...</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[SIZE=(.*?)\]/i</span>, <span class="ruby-value str">&quot;&lt;font size=\&quot;\\1\&quot;&gt;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/SIZE\]/i</span>,     <span class="ruby-value str">&quot;&lt;/font&gt;&quot;</span>)

          <span class="ruby-comment cmt">## URL</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[URL\]([^\[]+?)\[\/URL\]/i</span>, <span class="ruby-value str">&quot;&lt;a href=\&quot;\\1\&quot;&gt;\\1&lt;/a&gt;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[URL=(.*?)\](.+?)\[\/URL\]/i</span>, <span class="ruby-value str">&quot;&lt;a href=\&quot;\\1\&quot;&gt;\\2&lt;/a&gt;&quot;</span>)

          <span class="ruby-comment cmt">## IMG</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[IMG=(.*?)\]/i</span>, <span class="ruby-value str">&quot;&lt;img src=\&quot;\\1\&quot; /&gt;&quot;</span>)

          <span class="ruby-comment cmt">## ALIGN=center (TODO: right, left)</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[ALIGN=center\]/i</span>, <span class="ruby-value str">&quot;&lt;center&gt;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[ALIGN=right\]/i</span>,  <span class="ruby-value str">&quot;&lt;center&gt;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[ALIGN=left\]/i</span>,   <span class="ruby-value str">&quot;&lt;center&gt;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/ALIGN\]/i</span>,      <span class="ruby-value str">&quot;&lt;/center&gt;&quot;</span>)

          <span class="ruby-comment cmt">## QUOTE</span>
          <span class="ruby-identifier">quote</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\[QUOTE\]/i</span>
          <span class="ruby-identifier">quote</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\[\/QUOTE\]/i</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">quote</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">-1</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[QUOTE\]/i</span>,   <span class="ruby-value str">&quot;&lt;pre&gt;\n&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/QUOTE\]/i</span>, <span class="ruby-value str">&quot;&lt;/pre&gt;\n&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/^/</span>, <span class="ruby-value str">&quot;&amp;#62;&quot;</span><span class="ruby-operator">*</span><span class="ruby-identifier">quote</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">quote</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>

          <span class="ruby-comment cmt">## EMAIL</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[EMAIL\](.*?)\[\/EMAIL\]/i</span>, <span class="ruby-value str">&quot;&lt;a href=\&quot;mailto:\\1\&quot;&gt;\\1&lt;/a&gt;&quot;</span>)

          <span class="ruby-comment cmt">## LIST (TODO: LIST=1, LIST=A)</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[LIST(?:=(.*?))?\]/i</span>, <span class="ruby-value str">&quot;\n&lt;ul&gt;\n&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\/LIST\]/i</span>,          <span class="ruby-value str">&quot;\n&lt;/ul&gt;\n&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\[\*\]/i</span>,              <span class="ruby-value str">&quot;\n&lt;li /&gt;&quot;</span>)

          <span class="ruby-comment cmt">## FONT =&gt; font ??????</span>
          <span class="ruby-comment cmt">## ?BLUR?, FADE?</span>

          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s&lt;br /&gt;\n&quot;</span>, <span class="ruby-identifier">line</span>)
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000914"></a><b>html_to_ansi</b>(string)
  </div>
  <div class="description">
  <p>
Returns the (X)HTML markup code as ANSI sequences
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000914_source')" id="l_M000914_source">show source</a> ]</p>
  <div id="M000914_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 355</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">html_to_ansi</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-identifier">bbcoded</span> = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">html_to_bbcode</span>(<span class="ruby-identifier">string</span> )
      <span class="ruby-identifier">ansied</span>  = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_ansi</span>(<span class="ruby-identifier">bbcoded</span>)

      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ansied</span>
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000911"></a><b>html_to_bbcode</b>(string)
  </div>
  <div class="description">
  <p>
Converts a HTML string into one with <a href="BBCode.html">BBCode</a>
markup (TODO) Returns the (X)HTML markup string as <a
href="BBCode.html">BBCode</a>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000911_source')" id="l_M000911_source">show source</a> ]</p>
  <div id="M000911_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 223</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">html_to_bbcode</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-value str">&quot;&quot;</span>

      <span class="ruby-comment cmt">## Iterate over lines</span>
      <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/&lt;br *\/?&gt;/i</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">styles</span> = { <span class="ruby-value str">&quot;strong&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;b&quot;</span>, <span class="ruby-value str">&quot;b&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;b&quot;</span>,
                      <span class="ruby-value str">&quot;em&quot;</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;i&quot;</span>, <span class="ruby-value str">&quot;i&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;i&quot;</span>,
                      <span class="ruby-value str">&quot;u&quot;</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;u&quot;</span> }

          <span class="ruby-comment cmt">## preserve B, I, U</span>
          <span class="ruby-identifier">styles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">html</span>,<span class="ruby-identifier">code</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/&lt;#{html}&gt;/i</span>, <span class="ruby-node">&quot;[#{code.upcase}]&quot;</span>)
              <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/&lt;\/#{html}&gt;/i</span>, <span class="ruby-node">&quot;[/#{code.upcase}]&quot;</span>)
          <span class="ruby-keyword kw">end</span>

          <span class="ruby-comment cmt">## TODO: COLORs</span>
          <span class="ruby-comment cmt">## TODO: SIZEs</span>
          <span class="ruby-comment cmt">## TODO: FONTs</span>

          <span class="ruby-comment cmt">## EMAIL</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;a +href *= *\&quot;mailto:(.*?)\&quot;.*?&gt;.*?&lt;\/a&gt;/i</span>, <span class="ruby-value str">&quot;[EMAIL]\\1[/EMAIL]&quot;</span>)

          <span class="ruby-comment cmt">## URL</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;a +href *= *\&quot;((?:https?|ftp):\/\/.*?)\&quot;.*?&gt;(.*?)&lt;\/a&gt;/i</span>, <span class="ruby-value str">&quot;[URL=\\1]\\2[/URL]&quot;</span>)

          <span class="ruby-comment cmt">## Other refs + closing tags =&gt; throw away</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;a +href *= *\&quot;.*?\&quot;.*?&gt;/i</span>, <span class="ruby-value str">&quot;&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;\/a&gt;/i</span>,            <span class="ruby-value str">&quot;&quot;</span>)

          <span class="ruby-comment cmt">## IMG</span>
          <span class="ruby-comment cmt">#line.gsub!(/&lt;img +src *= *\&quot;(.*?)\&quot;.*?\/?&gt;/i, &quot;[IMG=\\1]&quot;)</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;img +src *= *\&quot;(.*?)\&quot;.*?\/?&gt;/i</span>, <span class="ruby-value str">&quot;[IMG]\\1[/IMG]&quot;</span>)

          <span class="ruby-comment cmt">## CENTER (right/left??)</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;center&gt;/i</span>,   <span class="ruby-value str">&quot;[ALIGN=center]&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;\/center&gt;/i</span>, <span class="ruby-value str">&quot;[/ALIGN]&quot;</span>)

          <span class="ruby-comment cmt">## QUOTE</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;(?:xmp|pre)&gt;/i</span>,   <span class="ruby-value str">&quot;[QUOTE]&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;\/(?:xmp|pre)&gt;/i</span>, <span class="ruby-value str">&quot;[/QUOTE]&quot;</span>)

          <span class="ruby-comment cmt">## LIST</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;ul&gt;/i</span>,      <span class="ruby-value str">&quot;\n[LIST]\n&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;\/ul&gt;/i</span>,    <span class="ruby-value str">&quot;\n[/LIST]\n&quot;</span>)
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;li *\/?&gt; */i</span>, <span class="ruby-value str">&quot;\n[*] &quot;</span>)

          <span class="ruby-comment cmt">## Unkown tags =&gt; throw away</span>
          <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;.*? *\/?&gt;/</span>, <span class="ruby-value str">&quot;&quot;</span>)

          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s&lt;br /&gt;\n&quot;</span>, <span class="ruby-identifier">line</span>)
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/&lt;br *\/?&gt;/i</span>, <span class="ruby-value str">&quot;\n&quot;</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000908"></a><b>strip_bbcode</b>(string)
  </div>
  <div class="description">
  <p>
&#8212; <a href="BBCode.html#M000908">strip_bbcode</a>( string ) Will strip
any <a href="BBCode.html">BBCode</a> tags from the given string.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000908_source')" id="l_M000908_source">show source</a> ]</p>
  <div id="M000908_source" class="dyn-source">
<pre>
<span class="ruby-comment cmt"># File lib/more/facets/bbcode.rb, line 123</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">strip_bbcode</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-identifier">string</span>.<span class="ruby-identifier">strip!</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\[[A-Za-z0-9\/=]+\]/</span>, <span class="ruby-value str">&quot;&quot;</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>

    </body>
</html>